<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Seletor de Cor - Chromix</title>
  <meta name="description" content="Descubra, crie e compartilhe paletas de cores incríveis. Ferramentas para designers e criativos.">
  <meta name="keywords" content="paleta de cores, design, cores, gradientes, WCAG, acessibilidade">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <link rel="stylesheet" href="styles.css">
</head>
<body class="d-flex flex-column min-vh-100">

  <header class="navbar navbar-expand-lg bg-body-tertiary shadow-sm sticky-top">
    <div class="container-xl">
      <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
        <div class="bg-brand-gradient-logo rounded-2 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
        </div>
        <span class="fs-4 fw-bold bg-brand-gradient-logo-text">Chromix</span>
      </a>
      
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-nav" aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <nav class="collapse navbar-collapse" id="main-nav">
        <ul class="navbar-nav mx-auto mb-2 mb-lg-0 gap-3">
          <li class="nav-item"><a class="nav-link" href="index.html">Início</a></li>
          <li class="nav-item"><a class="nav-link" href="palette-from-image.html">Paleta de Imagem</a></li>
          <li class="nav-item"><a class="nav-link" href="wcag-contrast.html">Contraste WCAG</a></li>
          <li class="nav-item"><a class="nav-link" href="gradients.html">Gradientes</a></li>
          <li class="nav-item"><a class="nav-link" href="color-picker.html">Seletor de Cor</a></li>
          <li class="nav-item"><a class="nav-link" href="tutorial.html">Tutorial</a></li> 
          <li class="nav-item"><a class="nav-link" href="references.html">Referências</a></li>
          <li class="nav-item"><a class="nav-link" href="create-logo.html">Crie sua Logo</a></li>
        </ul>

        <div class="d-flex align-items-center gap-3">
          <div id="auth-logged-out">
            <button id="signin-button" class="btn btn-primary rounded-3 px-4">
              Entrar
            </button>
          </div>
          <div id="auth-logged-in" class="d-flex align-items-center gap-3 d-none flex-nowrap"> 
            <div class="d-flex align-items-center gap-2 text-nowrap"> 
              <i data-lucide="user" class="text-secondary flex-shrink-0" style="width: 20px; height: 20px;"></i> 
              <span class="fw-medium text-dark username-truncate">Usuário</span> 
            </div>
            <button id="signout-button" class="btn btn-link text-decoration-none text-danger d-flex align-items-center gap-1 px-2 py-1 flex-shrink-0"> 
              <i data-lucide="log-out" style="width: 16px; height: 16px;"></i>
              <span>Sair</span>
            </button>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="flex-grow-1 bg-body-tertiary py-5">
    <div class="container-xl">
      <div class="text-center mb-5 fade-in-up">
        <div class="d-flex justify-content-center mb-4">
          <div class="rounded-4 d-flex align-items-center justify-content-center" style="width: 80px; height: 80px; background: linear-gradient(to right, #2D5016, #61A5C2);">
            <i data-lucide="zap" class="text-white" style="width: 40px; height: 40px;"></i>
          </div>
        </div>
        <h1 class="display-5 fw-bold text-dark mb-3">Seletor de Cor de Imagem</h1>
        <p class="fs-5 text-secondary mx-auto" style="max-width: 700px;">
          Clique em qualquer ponto de uma imagem para extrair a cor exata
        </p>
      </div>
  
      <div class="row g-4 g-lg-5">
        <div class="col-lg-8 fade-in-up" style="animation-delay: 0.2s;">
          <div class="card shadow-xl rounded-4 border-0 p-4 p-lg-5">
            <h2 class="fs-3 fw-bold text-dark mb-4">Imagem</h2>
            
            <div id="upload-section">
              <label for="image-upload" class="form-label w-100 cursor-pointer border border-3 border-dashed rounded-4 p-5 text-center text-secondary hover-bg-light transition-all">
                <i data-lucide="upload" class="mb-3" style="width: 48px; height: 48px;"></i>
                <p class="fs-5 fw-medium text-dark mb-1">Clique para fazer upload</p>
                <p class="mb-0">PNG, JPG, JPEG até 10MB</p>
              </label>
              <input type="file" accept="image/*" class="d-none" id="image-upload">
              <div class="mt-4">
                <h3 class="fs-5 fw-semibold text-dark mb-3">Ou use uma imagem de exemplo:</h3>
                <div id="sample-images" class="row g-3">
                </div>
              </div>
            </div>
  
            <div id="image-section" class="d-none">
              <div class="position-relative">
                <img id="image-ref" src="" alt="Selected" class="img-fluid rounded-4 shadow-lg cursor-default" style="max-height: 500px; width: 100%; object-fit: contain;" crossOrigin="anonymous" />
                <div id="picking-overlay" class="position-absolute top-0 start-0 w-100 h-100 bg-primary bg-opacity-10 rounded-4 d-none align-items-center justify-content-center pe-none"> 
                  <div class="bg-white bg-opacity-75 p-3 rounded-3 text-center">
                    <i data-lucide="crosshair" class="text-secondary mx-auto mb-2" style="width: 32px;"></i>
                    <p class="fw-medium text-dark mb-0">Clique na imagem para selecionar</p>
                  </div>
                </div>
              </div>
              <div class="d-flex justify-content-between align-items-center mt-4">
                <button id="picker-toggle-button" class="btn btn-primary btn-lg rounded-3">
                  <i data-lucide="crosshair" class="me-2" style="width: 16px;"></i>
                  <span>Ativar Seletor</span>
                </button>
                <button id="new-image-button" class="btn btn-outline-secondary btn-lg rounded-3">
                  Nova Imagem
                </button>
              </div>
            </div>
            <canvas id="canvas-ref" class="d-none"></canvas>
          </div>
        </div>
  
        <div class="col-lg-4 fade-in-up" style="animation-delay: 0.4s;">
          <div class="card shadow-xl rounded-4 border-0 p-4 p-lg-5">
            <h2 class="fs-3 fw-bold text-dark mb-4">Cor Selecionada</h2>
            <div id="color-info-placeholder" class="text-center py-5 text-secondary">
              <i data-lucide="crosshair" class="mb-3" style="width: 64px; height: 64px; opacity: 0.5;"></i>
              <p class="mb-1">Nenhuma cor selecionada</p>
              <small>Faça upload de uma imagem e ative o seletor</small>
            </div>
            <div id="color-info-details" class="d-none vstack gap-3">
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="bg-dark text-light pt-5">
    <div class="container-xl">
      <div class="row g-4">
        <div class="col-12 col-md-6">
          <div class="d-flex align-items-center gap-2 mb-3">
            <div class="bg-brand-gradient-logo rounded-2 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
            </div>
            <span class="fs-4 fw-bold bg-brand-gradient-logo-text">Chromix</span>
          </div>
          <p class="text-light opacity-75 mb-4" style="max-width: 450px;">
            Sua plataforma criativa para descobrir, criar e compartilhar paletas de cores incríveis. 
            Ferramentas profissionais para designers e criativos.
          </p>
          <div class="d-flex gap-2">
            <div class="rounded" style="width: 32px; height: 32px; background-color: var(--brand-blue);"></div>
            <div class="rounded" style="width: 32px; height: 32px; background-color: var(--brand-orange);"></div>
            <div class="rounded" style="width: 32px; height: 32px; background-color: var(--brand-red);"></div>
            <div class="rounded" style="width: 32px; height: 32px; background-color: var(--brand-green);"></div>
          </div>
        </div>

        <div class="col-12 col-md-3">
          <h5 class="fw-semibold mb-3">Links Rápidos</h5>
          <ul class="nav flex-column gap-2">
            <li class="nav-item"><a href="palette-from-image.html" class="nav-link p-0 text-light opacity-75 footer-link">Paleta de Imagem</a></li>
            <li class="nav-item"><a href="wcag-contrast.html" class="nav-link p-0 text-light opacity-75 footer-link">Contraste WCAG</a></li>
            <li class="nav-item"><a href="gradients.html" class="nav-link p-0 text-light opacity-75 footer-link">Gradientes</a></li>
            <li class="nav-item"><a href="color-picker.html" class="nav-link p-0 text-light opacity-75 footer-link">Seletor de Cor</a></li>
            <li class="nav-item"><a href="tutorial.html" class="nav-link p-0 text-light opacity-75 footer-link">Tutorial</a></li> 
            <li class="nav-item"><a href="references.html" class="nav-link p-0 text-light opacity-75 footer-link">Referências</a></li>
          </ul>
        </div>

        <div class="col-12 col-md-3">
          <h5 class="fw-semibold mb-3">Contato</h5>
          <ul class="nav flex-column gap-3">
            <li class="nav-item d-flex align-items-center gap-2">
              <i data-lucide="mail" class="text-primary" style="width: 16px; height: 16px;"></i>
              <span class="text-light opacity-75">contato@chromix.com</span>
            </li>
            <li class="nav-item d-flex align-items-center gap-2">
              <i data-lucide="phone" class="text-primary" style="width: 16px; height: 16px;"></i>
              <span class="text-light opacity-75">+55 11 9999-9999</span>
            </li>
            <li class="nav-item d-flex align-items-center gap-2">
              <i data-lucide="map-pin" class="text-primary" style="width: 16px; height: 16px;"></i>
              <span class="text-light opacity-75">São Paulo, Brasil</span>
            </li>
          </ul>
        </div>
      </div>

      <div class="border-top border-secondary-subtle mt-4 py-4 text-center">
        <p class="text-light opacity-50 m-0 small"> 
          © 2025 Chromix. Todos os direitos reservados. Criado com ❤️ para designers e criativos.
        </p>
      </div>
    </div>
  </footer>

  <div class="toast-container position-fixed top-0 end-0 p-3">
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script src="shared.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let isPickingMode = false; 
      let selectedImage = null; 
      let pickedColor = null;
      let isImageLoaded = false; 

      const imageUpload = document.getElementById('image-upload');
      const canvasRef = document.getElementById('canvas-ref');
      const imageRef = document.getElementById('image-ref');
      const uploadSection = document.getElementById('upload-section');
      const imageSection = document.getElementById('image-section');
      const pickerToggleButton = document.getElementById('picker-toggle-button');
      const newImageButton = document.getElementById('new-image-button');
      const pickingOverlay = document.getElementById('picking-overlay');
      const colorInfoPlaceholder = document.getElementById('color-info-placeholder');
      const colorInfoDetails = document.getElementById('color-info-details');
      const sampleImagesContainer = document.getElementById('sample-images');
  
      const ctx = canvasRef ? canvasRef.getContext('2d', { willReadFrequently: true }) : null;
      if (!ctx) {
         console.error("Não foi possível obter o contexto 2D do canvas. O seletor de cor não funcionará.");
         if (pickerToggleButton) pickerToggleButton.disabled = true;
      }

      const sampleImages = [
        'https://images.pexels.com/photos/1103970/pexels-photo-1103970.jpeg?w=600',
        'https://images.pexels.com/photos/1287145/pexels-photo-1287145.jpeg?w=600',
        'https://images.pexels.com/photos/1671325/pexels-photo-1671325.jpeg?w=600',
        'https://images.pexels.com/photos/1212693/pexels-photo-1212693.jpeg?w=600',
        'https://images.pexels.com/photos/994605/pexels-photo-994605.jpeg?w=600',
        'https://images.pexels.com/photos/147411/italy-mountains-dawn-daybreak-147411.jpeg?w=600'
      ];
      
      const copyColor = (color) => { 
        navigator.clipboard.writeText(color)
          .then(() => showToast(`Cor ${color} copiada!`, 'success'))
          .catch(err => showToast('Erro ao copiar.', 'error')); 
      };

      const getColorInfo = (hex) => {
        try {
          const r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16); 
          const rN = r / 255, gN = g / 255, bN = b / 255; 
          const max = Math.max(rN, gN, bN), min = Math.min(rN, gN, bN); 
          const diff = max - min; 
          let h = 0; 
          const l = (max + min) / 2; 
          const s = diff === 0 ? 0 : diff / (1 - Math.abs(2 * l - 1));
          if (diff !== 0) { 
            switch (max) { 
              case rN: h = ((gN - bN) / diff) % 6; break; 
              case gN: h = (bN - rN) / diff + 2; break; 
              case bN: h = (rN - gN) / diff + 4; break; 
            } 
          } 
          h = Math.round(h * 60); 
          if (h < 0) h += 360;
          return { hex, rgb: `rgb(${r}, ${g}, ${b})`, hsl: `hsl(${h}, ${Math.round(s * 100)}%, ${Math.round(l * 100)}%)`, v: { h, s: Math.round(s * 100), l: Math.round(l * 100) } };
        } catch (e) {
          console.error("Erro ao processar cor:", hex, e);
          return { hex, rgb: 'N/A', hsl: 'N/A', v: {h:0, s:0, l:0}}; 
        }
      };

      const renderColorInfo = (color) => {
        if (!color || !/^#[0-9A-F]{6}$/i.test(color)) {
            console.warn("Cor inválida recebida:", color);
            resetColorInfo(); 
            return;
        }
        const info = getColorInfo(color);
        colorInfoDetails.innerHTML = `
          <div class="w-100 rounded-4 shadow-lg border border-4 border-white" style="height: 150px; background-color: ${info.hex}"></div>
          <div class="list-group">
            ${renderValueRow('HEX', info.hex, 'font-monospace fs-5', info.hex)}
            ${renderValueRow('RGB', info.rgb, 'font-monospace', info.rgb)}
            ${renderValueRow('HSL', info.hsl, 'font-monospace', info.hsl)}
          </div>
          <div class="alert alert-info mb-0">
            <div class="d-flex align-items-center gap-2 mb-2">
              <i data-lucide="info" style="width: 20px;"></i> <span class="fw-semibold">Análise da Cor</span>
            </div>
            <p class="mb-0 small">Matiz: ${info.v.h}° | Saturação: ${info.v.s}% | Luminosidade: ${info.v.l}%</p>
          </div>`;
        colorInfoPlaceholder.classList.add('d-none'); 
        colorInfoDetails.classList.remove('d-none'); 
        lucide.createIcons();
      };

      const renderValueRow = (label, value, vClass, copy) => `
        <div class="list-group-item d-flex justify-content-between align-items-center p-3">
          <span class="fw-medium text-dark">${label}</span>
          <div class="d-flex align-items-center gap-2">
            <code class="${vClass}">${value}</code>
            <button class="btn btn-link text-secondary p-1 copy-button" data-color="${copy}" title="Copiar ${label}">
              <i data-lucide="copy" style="width: 16px;" class="pointer-events-none"></i>
            </button>
          </div>
        </div>`;
        
      const resetColorInfo = () => { 
        pickedColor = null; 
        colorInfoPlaceholder.classList.remove('d-none'); 
        colorInfoDetails.classList.add('d-none'); 
        colorInfoDetails.innerHTML = ''; 
      };

      const resetAll = () => { 
        selectedImage = null; 
        isPickingMode = false; 
        isImageLoaded = false;
        resetColorInfo(); 
        imageRef.src = ''; 
        imageSection.classList.add('d-none'); 
        uploadSection.classList.remove('d-none'); 
        imageUpload.value = null; 
        setPickingMode(false); 
      };

      const setImage = (src) => { 
        selectedImage = src; 
        isImageLoaded = false; 
        pickerToggleButton.disabled = true; 
        imageRef.src = src; 
        uploadSection.classList.add('d-none'); 
        imageSection.classList.remove('d-none'); 
        resetColorInfo(); 
        setPickingMode(false); 
      };
      
      const setPickingMode = (mode) => {
        isPickingMode = mode;
        if (isPickingMode) {
          if (!isImageLoaded || !ctx) { 
             showToast("Aguarde a imagem carregar completamente ou verifique o console.", "error");
             isPickingMode = false; 
             return; 
          }
          imageRef.classList.add('cursor-crosshair'); 
          imageRef.classList.remove('cursor-default');
          pickingOverlay.classList.remove('d-none'); 
          pickingOverlay.classList.add('d-flex');
          pickerToggleButton.innerHTML = '<i data-lucide="x" class="me-2" style="width: 16px;"></i><span>Cancelar</span>';
          pickerToggleButton.classList.add('btn-danger'); 
          pickerToggleButton.classList.remove('btn-primary');
        } else {
          imageRef.classList.remove('cursor-crosshair'); 
          imageRef.classList.add('cursor-default');
          pickingOverlay.classList.add('d-none'); 
          pickingOverlay.classList.remove('d-flex');
          pickerToggleButton.innerHTML = '<i data-lucide="crosshair" class="me-2" style="width: 16px;"></i><span>Ativar Seletor</span>';
          pickerToggleButton.classList.remove('btn-danger'); 
          pickerToggleButton.classList.add('btn-primary');
        }
        lucide.createIcons();
      };
      
      sampleImages.forEach((src, index) => {
        const buttonWrapper = document.createElement('div'); 
        buttonWrapper.className = 'col-6 col-md-4'; 
        const button = document.createElement('button');
        button.className = 'btn border-0 p-0 rounded-3 overflow-hidden shadow-sm w-100'; 
        button.innerHTML = `<img src="${src}" alt="Exemplo ${index + 1}" class="img-fluid w-100" style="height: 120px; object-fit: cover;" crossOrigin="anonymous">`; 
        button.addEventListener('click', () => setImage(src));
        buttonWrapper.appendChild(button);
        sampleImagesContainer.appendChild(buttonWrapper);
      });
      
      imageRef.onload = () => {
          isImageLoaded = true;
          pickerToggleButton.disabled = false; 
          const img = imageRef;
          if (ctx && img.complete && img.naturalHeight !== 0) {
             canvasRef.width = img.naturalWidth;
             canvasRef.height = img.naturalHeight;
             try {
                ctx.drawImage(img, 0, 0, img.naturalWidth, img.naturalHeight);
                console.log("Imagem pré-desenhada no canvas.");
             } catch (e) {
                console.error("Erro ao desenhar imagem no canvas (onload):", e);
                if (e.name === 'SecurityError') {
                    showToast('Não é possível processar esta imagem devido a restrições de segurança (CORS). Tente uma imagem do seu dispositivo.', 'error');
                } else {
                    showToast("Erro ao carregar a imagem para seleção.", "error");
                }
                resetAll(); 
             }
          }
      };
      
      imageRef.onerror = () => {
         console.error("Erro ao carregar a imagem:", imageRef.src);
         showToast("Erro ao carregar a imagem selecionada. Verifique o URL ou o arquivo.", "error");
         resetAll();
      }

      imageUpload.addEventListener('change', (e) => {
        const file = e.target.files[0]; 
        if (!file) return;
        const reader = new FileReader(); 
        reader.onload = (e) => setImage(e.target.result); 
        reader.readAsDataURL(file);
      });

      newImageButton.addEventListener('click', resetAll);
      pickerToggleButton.addEventListener('click', () => setPickingMode(!isPickingMode));
      
      imageRef.addEventListener('click', (event) => {
        if (!isPickingMode || !isImageLoaded || !ctx) {
          console.log("Modo picker não ativo ou imagem/canvas não pronto.");
          return;
        } 
        
        const img = imageRef; 
        const rect = img.getBoundingClientRect(); 
        const scaleX = img.naturalWidth / rect.width;
        const scaleY = img.naturalHeight / rect.height;
        const x = Math.max(0, Math.min(Math.floor((event.clientX - rect.left) * scaleX), img.naturalWidth - 1)); 
        const y = Math.max(0, Math.min(Math.floor((event.clientY - rect.top) * scaleY), img.naturalHeight - 1));
        
        try {
            const imageData = ctx.getImageData(x, y, 1, 1); 
            const data = imageData.data; 
            const hex = `#${[data[0], data[1], data[2]].map(c => c.toString(16).padStart(2, '0')).join('')}`;
            
            pickedColor = hex; 
            renderColorInfo(pickedColor); 
            setPickingMode(false); 
            showToast('Cor selecionada!', 'success');
        } catch (e) {
            console.error("Erro ao obter dados da imagem (getImageData):", e);
            if (e.name === 'SecurityError') {
                 showToast('Não é possível ler os pixels desta imagem devido a restrições de segurança (CORS). Tente uma imagem do seu dispositivo.', 'error');
            } else {
                 showToast('Erro ao selecionar a cor.', 'error');
            }
            setPickingMode(false); 
        }
      });
      
      colorInfoDetails.addEventListener('click', (e) => { 
        const btn = e.target.closest('.copy-button'); 
        if (btn) copyColor(btn.dataset.color); 
      });

      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    });
  </script>
</body>
</html>